<script src='scripts/jquery.js'></script>
<script src='scripts/bc-background.js'></script>
<script>
	chrome.extension.onMessage.addListener(
		function(request, sender, sendResponse) {
			switch(request.method) {
				case "getnews" : {
					var rss = getNews();
					sendResponse({feed: rss});
				} break;
				default:{
				}break;
			}
			
		}
	);
	
	function getNews() {
		var news = new Array();
		$.ajax({
			url:"http://www.bungie.net/News/NewsRss.ashx",
			method:"GET",
			async:false,
			dataType:"XML",
			success:function(data) {
					
				$($(data).find('item')).each(function() {
				
					var item = {};
					item.title = $(this).find('title').text();
					item.link = $(this).find('link').text();
					item.pubDate = $(this).find('pubDate').text();
					news.push(item);
					
				});
			}
		});
		$.ajax({
			url:"http://api.twitter.com/1/statuses/user_timeline.rss?user_id=26280712&count=20",
			method:"GET",
			async:false,
			dataType:"XML",
			success:function(data) {
				
				$($(data).find('item')).each(function() {
				
					var item = {};
					item.title = $(this).find('title').text();
					item.link = $(this).find('link').text();
					item.pubDate = $(this).find('pubDate').text();
					news.push(item);
				});
			}
		});
		
		
		news.sort(function(a, b) {
		
			var lhsDate = new Date(a.pubDate.replace("+0000", "GMT"));
			var rhsDate = new Date(b.pubDate.replace("+0000", "GMT"));
			
			if ( lhsDate > rhsDate ) {
				return -1;
			}	
			if ( rhsDate > lhsDate ) {
				return 1;
			}
			return 0;
		});
		
		return JSON.stringify(news);
	}
	
</script>